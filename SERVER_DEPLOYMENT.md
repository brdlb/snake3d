# Деплой Socket.IO сервера

Ваш Socket.IO сервер нужно развернуть отдельно от фронтенда, так как Cloudflare Pages не поддерживает WebSocket серверы напрямую.

## Рекомендуемые платформы

### 1. Railway (Рекомендуется) ⭐

**Преимущества:**
- Бесплатный tier ($5 кредитов в месяц)
- Автоматический деплой из GitHub
- Простая настройка
- Поддержка WebSocket из коробки

**Шаги:**

1. Зарегистрируйтесь на [railway.app](https://railway.app)
2. Нажмите "New Project" → "Deploy from GitHub repo"
3. Выберите ваш репозиторий `snake3d`
4. Railway автоматически обнаружит `railway.json` и развернет сервер
5. После деплоя скопируйте URL сервера (например, `https://snake3d-server.railway.app`)
6. Обновите `SOCKET_SERVER_URL` в вашем фронтенде

**Переменные окружения (опционально):**
- `PORT` - порт сервера (Railway установит автоматически)
- `FRONTEND_URL` - URL вашего фронтенда на Cloudflare Pages

### 2. Render

**Преимущества:**
- Бесплатный tier
- Автоматический деплой из GitHub
- Простая настройка

**Шаги:**

1. Зарегистрируйтесь на [render.com](https://render.com)
2. Нажмите "New" → "Web Service"
3. Подключите ваш GitHub репозиторий
4. Render автоматически обнаружит `render.yaml`
5. Нажмите "Create Web Service"
6. После деплоя скопируйте URL сервера
7. Обновите `SOCKET_SERVER_URL` в вашем фронтенде

**Примечание:** Бесплатный tier Render засыпает после 15 минут неактивности, первое подключение может занять ~30 секунд.

### 3. Glitch

**Преимущества:**
- Полностью бесплатный
- Онлайн редактор кода
- Мгновенный деплой

**Шаги:**

1. Зарегистрируйтесь на [glitch.com](https://glitch.com)
2. Создайте новый Node.js проект
3. Импортируйте код из GitHub или скопируйте файлы вручную
4. Glitch автоматически запустит сервер
5. Скопируйте URL проекта
6. Обновите `SOCKET_SERVER_URL` в вашем фронтенде

### 4. Cloudflare Workers + Durable Objects (Продвинутый вариант)

Если вы хотите держать всё на Cloudflare, можно переписать сервер под Durable Objects API.

**Преимущества:**
- Всё в одной экосистеме
- Глобальное распределение
- Низкая задержка

**Недостатки:**
- Требует переписывания кода
- Нельзя использовать файловую систему (нужно использовать Durable Object Storage или D1)
- Более сложная настройка

Если вы хотите пойти этим путём, дайте знать - я помогу с миграцией.

## Обновление фронтенда

После деплоя сервера, обновите URL в вашем клиентском коде:

```typescript
// src/main.ts или где у вас инициализация Socket.IO
const SOCKET_SERVER_URL = 'https://your-server-url.railway.app'; // Замените на ваш URL
```

Или используйте переменные окружения:

```typescript
const SOCKET_SERVER_URL = import.meta.env.VITE_SOCKET_SERVER_URL || 'http://localhost:3000';
```

И создайте `.env` файл:

```env
VITE_SOCKET_SERVER_URL=https://your-server-url.railway.app
```

## Проверка работы

После деплоя проверьте:

1. Откройте URL сервера в браузере - должна загрузиться страница (если сервер отдаёт статику)
2. Проверьте логи на платформе деплоя
3. Попробуйте подключиться с фронтенда

## Troubleshooting

### CORS ошибки

Если видите CORS ошибки, убедитесь что:
1. URL фронтенда добавлен в `allowedOrigins` в `server/index.ts`
2. Или установите переменную окружения `FRONTEND_URL` на платформе деплоя

### Сервер не запускается

Проверьте:
1. Логи на платформе деплоя
2. Правильность команд в `package.json`
3. Наличие всех зависимостей в `package.json`

### WebSocket не подключается

1. Убедитесь что платформа поддерживает WebSocket (все перечисленные выше поддерживают)
2. Проверьте что используете правильный протокол (`wss://` для HTTPS, `ws://` для HTTP)
3. Проверьте firewall и сетевые настройки
